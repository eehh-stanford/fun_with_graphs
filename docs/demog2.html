<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Demography II: Matrix Population Models – Fun with Graphs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./demog1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-626149efe8f5d16e1d391ba177679bf0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./demog2.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Demography II: Matrix Population Models</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Fun with Graphs</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Fun with Graphs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gettingR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Started in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interpreting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Interpreting Scientific Figures</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./drawing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Theoretical Scientific Figures in <code>R</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Actual Graphs</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./odes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">ODEs in <code>R</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./demog1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Demography I: Mortality</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./demog2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Demography II: Matrix Population Models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#population-growth" id="toc-population-growth" class="nav-link active" data-scroll-target="#population-growth"><span class="header-section-number">7.1</span> Population Growth</a></li>
  <li><a href="#population-growth-with-age-structure" id="toc-population-growth-with-age-structure" class="nav-link" data-scroll-target="#population-growth-with-age-structure"><span class="header-section-number">7.2</span> Population Growth with Age Structure</a></li>
  <li><a href="#the-leslie-matrix" id="toc-the-leslie-matrix" class="nav-link" data-scroll-target="#the-leslie-matrix"><span class="header-section-number">7.3</span> The Leslie Matrix</a>
  <ul class="collapse">
  <li><a href="#the-life-cycle-diagram" id="toc-the-life-cycle-diagram" class="nav-link" data-scroll-target="#the-life-cycle-diagram"><span class="header-section-number">7.3.1</span> The Life Cycle Diagram</a></li>
  </ul></li>
  <li><a href="#growth-of-structured-populations" id="toc-growth-of-structured-populations" class="nav-link" data-scroll-target="#growth-of-structured-populations"><span class="header-section-number">7.4</span> Growth of Structured Populations</a>
  <ul class="collapse">
  <li><a href="#projection-the-simplest-form-of-analysis" id="toc-projection-the-simplest-form-of-analysis" class="nav-link" data-scroll-target="#projection-the-simplest-form-of-analysis"><span class="header-section-number">7.4.1</span> Projection, The Simplest Form of Analysis</a></li>
  </ul></li>
  <li><a href="#constructing-a-leslie-matrix" id="toc-constructing-a-leslie-matrix" class="nav-link" data-scroll-target="#constructing-a-leslie-matrix"><span class="header-section-number">7.5</span> Constructing a Leslie Matrix</a>
  <ul class="collapse">
  <li><a href="#subdiagonal" id="toc-subdiagonal" class="nav-link" data-scroll-target="#subdiagonal"><span class="header-section-number">7.5.1</span> Subdiagonal</a></li>
  <li><a href="#first-row" id="toc-first-row" class="nav-link" data-scroll-target="#first-row"><span class="header-section-number">7.5.2</span> First Row</a></li>
  <li><a href="#fun-facts-about-eigenvalues" id="toc-fun-facts-about-eigenvalues" class="nav-link" data-scroll-target="#fun-facts-about-eigenvalues"><span class="header-section-number">7.5.3</span> Fun facts about Eigenvalues</a></li>
  </ul></li>
  <li><a href="#left-eigenvectors-of-the-projection-matrix" id="toc-left-eigenvectors-of-the-projection-matrix" class="nav-link" data-scroll-target="#left-eigenvectors-of-the-projection-matrix"><span class="header-section-number">7.6</span> Left Eigenvectors of the Projection Matrix</a></li>
  <li><a href="#spectral-decomposition-of-the-projection-matrix" id="toc-spectral-decomposition-of-the-projection-matrix" class="nav-link" data-scroll-target="#spectral-decomposition-of-the-projection-matrix"><span class="header-section-number">7.7</span> Spectral Decomposition of the Projection Matrix</a></li>
  <li><a href="#matrix-perturbations" id="toc-matrix-perturbations" class="nav-link" data-scroll-target="#matrix-perturbations"><span class="header-section-number">7.8</span> Matrix Perturbations</a></li>
  <li><a href="#elasticities" id="toc-elasticities" class="nav-link" data-scroll-target="#elasticities"><span class="header-section-number">7.9</span> Elasticities</a>
  <ul class="collapse">
  <li><a href="#relationship-to-hamilton" id="toc-relationship-to-hamilton" class="nav-link" data-scroll-target="#relationship-to-hamilton"><span class="header-section-number">7.9.1</span> Relationship to Hamilton</a></li>
  </ul></li>
  <li><a href="#calculating-sensitivities" id="toc-calculating-sensitivities" class="nav-link" data-scroll-target="#calculating-sensitivities"><span class="header-section-number">7.10</span> Calculating Sensitivities</a></li>
  <li><a href="#some-demographic-analysis" id="toc-some-demographic-analysis" class="nav-link" data-scroll-target="#some-demographic-analysis"><span class="header-section-number">7.11</span> Some Demographic Analysis</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-matrix" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Demography II: Matrix Population Models</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="population-growth" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="population-growth"><span class="header-section-number">7.1</span> Population Growth</h2>
</section>
<section id="population-growth-with-age-structure" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="population-growth-with-age-structure"><span class="header-section-number">7.2</span> Population Growth with Age Structure</h2>
<p>In this section, we will introduce the idea of population projection matrices. The special case of such matrices for projecting an age-structured population is known as the <strong>Leslie matrix</strong>, after the British biologist, P.H. Leslie, who first formalized the method in his 1945 paper.</p>
<p>We start with a simple example, where we extend the analysis of population growth to a situation where the population is <strong>structured</strong>, meaning that different groups of individuals within the population (e.g., age classes, sexes, geographic regions) are characterized by different demographic rates. Assume that we have an organism with two age-classes. Then the population growth is now described by the following two equations:</p>
<p><span class="math display">\[
\begin{align}
  n_1(t+1) &amp; =  f_{1}n_{1}(t) + f_{2}n_{2}(t) \\
  n_2(t+1) &amp; =  p_{1}n_{1}
\end{align}
\]</span></p>
<p>where <span class="math inline">\(n_{1}\)</span> is the number in stage 1, <span class="math inline">\(n_{2}\)</span> is the number in stage 2, <span class="math inline">\(f_{1}\)</span> is the fertility of stage 1 individuals, <span class="math inline">\(f_{2}\)</span> is the fertility of stage 2 individuals, and <span class="math inline">\(p_{1}\)</span> is the survivals of 1’s to age class 2.</p>
<p>One question we wish to answer: Is there a unique exponential growth rate for such a population analogous to the unstructured case? Imagine you start with a total population size (<span class="math inline">\(N(0) = n_{1}(0) + n_{2}(0)\)</span>) of 10. What will the population look like in one time step? If there are 10 ones and zero twos, then we have</p>
<p><span class="math display">\[
\begin{align}
        n_{1}(1) &amp; = 10f_{1}  \\
        n_{2}(1) &amp; = 10p_{1}
\end{align}
\]</span></p>
<p>However, if there are zero ones and 10 twos, then we have a very different situation:</p>
<p><span class="math display">\[
\begin{align}
   n_{1}(1) &amp; = 10f_{2} \\
   n_{2}(1) &amp; = 0
\end{align}
\]</span></p>
<p>These two populations can only increase at the same rate in the degenerate case where <span class="math inline">\(f_1=f_2\)</span> and <span class="math inline">\(p_1=0\)</span>. The solution to this apparent paradox is that a structured population will grow geometrically only when the ratios between the different classes of the population remain constant. In the age-structured case, we call this the <strong>stable age distribution</strong> and in the state-structured case, we call it the stable stage distribution.</p>
<p>These two sets of equations can be represented in the compact notation of matrices and the rules for working with them derived from linear algebra.</p>
<p>First, some definitions. A <strong>matrix</strong> is a rectangular array of numbers. We typically represent matrices by bold face upper-case letters. We indicate an element of a matrix by the lower case letter in plain face, indexed by subscripted row followed by column numbers:</p>
<p><span class="math display">\[
\mathbf{A} = \left[ \begin{array}{cc}
                     a_{11} &amp; a_{12}  \\
             a_{21} &amp; a_{22}
    \end{array} \right]
\]</span> The element <span class="math inline">\(a_{12}\)</span> therefore represents the matrix entry from the first row and second column of matrix <span class="math inline">\(\mathbf{A}\)</span></p>
<p>A vector is simply a list of numbers. Vectors are typically bold face lower-case letters and elements are indexed by their position in the vector with a subscripted number. Vectors can come as either row or column vectors.</p>
<p><span class="math display">\[
\mathbf{n(t)} = \left[ \begin{array}{c}
                       n_{1} \\
                   n_{2} \\
                   n_{3}
                       \end{array} \right]
\]</span></p>
<p>A scalar is a single number: <span class="math inline">\(\lambda = 1.05\)</span>.</p>
</section>
<section id="the-leslie-matrix" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="the-leslie-matrix"><span class="header-section-number">7.3</span> The Leslie Matrix</h2>
<p>The <strong>Leslie matrix</strong> is a special matrix for demography and population biology. It is referred to as a Leslie Matrix after its inventor Sir Paul Leslie (Leslie 1945, 1948). A Leslie matrix contains: (1) age-specific fertilities along the first row, (2) age-specific survival probabilities along the subdiagonal, and (3) zeros everywhere else. Here is an example of a <span class="math inline">\(5 \times 5\)</span> Leslie matrix:</p>
<p><span class="math display">\[
\mathbf{A} = \left[ \begin{array}{ccccc}
                   0     &amp; F_{2}   &amp; F_{3} &amp; F_{4} &amp; F_{5}\\
                   P_{1} &amp; 0       &amp; 0     &amp; 0     &amp; 0 \\
                   0     &amp; P_2     &amp; 0     &amp; 0     &amp; 0\\
                   0     &amp; 0       &amp; P_3   &amp; 0     &amp; 0 \\
                   0     &amp; 0       &amp; 0     &amp; P_{4} &amp; 0
\end{array} \right]
\]</span></p>
<p>The Leslie matrix is a special case of a <strong>projection matrix</strong> for an age-classified population. With age-structure, the only transitions that can happen are from one age to the next and from adult ages back to the first age class. Can you imagine a projection matrix structured by something other than age?</p>
<p>A couple points: all the age classes are the same width (cf.&nbsp;an abridged life table). This is also the projection interval. So if your age classes are five years wide, each step of your population projection is five years. If you want to get an annual growth rate, you need to divide by five. If you need to have classes with different durations, you can’t use a Leslie matrix. You need a matrix that models more general stages. The projection interval will remain constant, but you can have different amounts of time spent (sojourn times) in different stages. More on this later.</p>
<p>Leslie matrices are sparse. Most of their elements (particularly when you have more age classes) are zero. These elements are known as <strong>structural zeros</strong>. By the definition of our life cycle, they represent impossible transitions. The Leslie matrix contains only two logical transitions: individuals get one age-class older per time step; new individuals can be created from older ones. For example, in an age-structured life cycle, you can’t make a transition from the fourth to the second age class. Element <span class="math inline">\(a_{42}\)</span> is a structural zero. A structural zero contrasts with a transition that is logically possible in our life cycle but just happens to have a transition probability/rate equal to zero.</p>
<section id="the-life-cycle-diagram" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="the-life-cycle-diagram"><span class="header-section-number">7.3.1</span> The Life Cycle Diagram</h3>
<p>It is useful to think of the matrix entries in a life-cycle manner. The entry <span class="math inline">\(a_{ij}\)</span> is the transition probability of going from age <span class="math inline">\(j\)</span> to age <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[
    a_{ij} \equiv a_{i \leftarrow j}.
\]</span></p>
<p>So these rates mean that you end up in the row index and start in the column index. It’s worth noting that this convention is different than the use of matrices in many applications. For example, social mobility matrices, that have historically modeled the occupational status of a son compared to his father, typically move individuals from row to column. Either way works; you just need to know what the convention is in any given field.</p>
<p>We can formalize the life-cycle approach by noting the linkages between the projection matrix and the <strong>life-cycle graph</strong>. A life-cycle graph is a digraph (or directed graph) composed two things: (1) nodes, which represent the states (ages, stages, subgroups, localities, etc.) and (2) edges, which represent transitions between states. The following figure presents a simple age-structured life cycle with five ages and reproduction in age classes 2-5.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/life-cycle.png" class="img-fluid figure-img"></p>
<figcaption>An age-classified life-cycle graph with five age classes.</figcaption>
</figure>
</div>
<p>There are a number of desirable properties of demographic projection matrices. These properties are required for all the important results that we will discuss to apply. Every demographic matrix is non-negative (all its entries are greater than or equal to zero). In general, we are only interested in non-negative matrices since all survival probabilities and fertility rates must be non-negative. Indeed, any rate of interest in demography must be positive. We have seen that it is important for the elements of a structured population model to come to some sort of stable distribution. However, not all population models do this. Fortunately, the conditions that allow a population to converge to its stable age distribution are simple and the use of the life cycle graph greatly facilitates determining if the conditions do indeed apply. In order for a population to converge on its stable population structure, it must be <strong>irreducible</strong>. A matrix is irreducible if and only if there is a path between every node and every other node in the life cycle graph. Irreducibility is necessary but not sufficient for stability. The second, sufficient condition is called <strong>primitivity</strong>. An irreducible non-negative matrix is primitive if all its elements become positive when raised to sufficiently high powers. A matrix is primitive if the greatest common divisor of all loops in the corresponding life-cycle graph is 1.</p>
<p>Here are two examples of reducible life cycles that will not converge to stable distributions.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/reducible-life-cycle.png" class="img-fluid figure-img"></p>
<figcaption>A reducible life cycle, with a post-reproductive stage.</figcaption>
</figure>
</div>
<p>The life-cycle graph makes it easy to determine whether there are any stages that cannot contribute (even indirectly) to another stage. A common case of such a life cycle is one with post-reproductive stages. In this graph, age-class 5 individuals cannot contribute to any of the preceding classes (because they’re post-reproductive!).</p>
<p>There are other ways to be reducible. Here is a fanciful example.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/weird-reducible.png" class="img-fluid figure-img"></p>
<figcaption>A weird reducible life cycle with who knows what going on!</figcaption>
</figure>
</div>
<p>Next, we have an imprimitive life cycle. Reproduction only occurs in the even ages. This causes bulges in the age pyramid that never get evened out. Consequently, the population never converges to a stable age distribution. Be careful with the terminology as it can be confusing: <em>you want your matrix to be irreducible but primitive</em>, not reducible and imprimitive.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/imprimitive-life-cycle.png" class="img-fluid figure-img"></p>
<figcaption>A imprimitive life cycle, where reproduction only happens in ages that are multiples of each other.</figcaption>
</figure>
</div>
<p>Two ways of insuring that a life cycle will be primitive are: (1) having two consecutive age classes in which reproduction occurs or (2) having a life cycle with a self loop.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/self-loop.png" class="img-fluid figure-img"></p>
<figcaption>The same life cycle with a self-loop makes it primitive.</figcaption>
</figure>
</div>
<p>This example is a bit of a preview. By putting a self-look on the fourth age class, we’ve turned it from an age class into a stage. The matrix representation of this life cycle will include an element on the diagonal of the matrix in the fourth row and fourth column.</p>
</section>
</section>
<section id="growth-of-structured-populations" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="growth-of-structured-populations"><span class="header-section-number">7.4</span> Growth of Structured Populations</h2>
<p>Having redefined the population model in matrix form, we can write it in a more compact notation of matrix algebra:</p>
<p><span class="math display">\[
\mathbf{n}(t+1) = \mathbf{A} \mathbf{n}(t)
\]</span></p>
<p>Let’s now assume that there is a solution to the exponential growth model in a structured population. Write the population model as:</p>
<p><span class="math display">\[
\mathbf{An} = \lambda \mathbf{n}
\]</span></p>
<p>Now solve for <span class="math inline">\(\lambda\)</span>. The rules of linear algebra make this a little trickier than just dividing both sides by <span class="math inline">\(\mathbf{n}\)</span>. Here are the steps we need:</p>
<p><span class="math display">\[
  \mathbf{An} - \lambda \mathbf{n} = 0
\]</span></p>
<p><span class="math display">\[
  \mathbf{An} - \lambda \mathbf{I n} = 0
\]</span></p>
<p><span class="math display">\[
  (\mathbf{A} - \lambda \mathbf{I}) \mathbf{n} = 0
\]</span></p>
<p><span class="math inline">\(\mathbf{I}\)</span> is an identity matrix of the same rank as <span class="math inline">\(\mathbf{A}\)</span> (ones along the diagonal, zeros elsewhere).</p>
<p>It’s a fact of linear algebra, that the solution to this equation exists only if the determinant of the matrix <span class="math inline">\((\mathbf{An} - \lambda \mathbf{I})\)</span> is zero. For the <span class="math inline">\(2 \times 2\)</span> case, the determinant is simple. For any <span class="math inline">\(2 \times 2\)</span> matrix the determinant is given by:</p>
<p><span class="math display">\[  \det \left[ \begin{array}{cc}
    a  &amp; b  \\
    c &amp; d
  \end{array} \right] = ad - bc
\]</span></p>
<p>Determinants of matrices of larger rank are, necessarily, more complex.</p>
<p>So, using our fact of linear algebra, we can proceed with the calculation:</p>
<p><span class="math display">\[ (\mathbf{A} - \lambda \mathbf{I}) = \left[ \begin{array}{cc}
        f_{1}  &amp; f_{2}  \\
        p_{1} &amp; 0
    \end{array} \right] - \left[ \begin{array}{cc}
            \lambda &amp; 0  \\
        0       &amp; \lambda
    \end{array} \right] = \left[ \begin{array}{cc}
        f_{1} - \lambda   &amp; f_{2}  \\
        p_{1} &amp; - \lambda  
    \end{array} \right]
\]</span></p>
<p><span class="math display">\[
  \det (\mathbf{A} - \lambda \mathbf{I}) = -(f_{1} - \lambda)
    \lambda - f_{2} p_{1}
    \]</span> Multiply out:</p>
<p><span class="math display">\[ \lambda^{2} - f_{1} \lambda - f_{2}p_{1} = 0  \]</span></p>
<p>Use the quadratic equation to solve for <span class="math inline">\(\lambda\)</span>:</p>
<p><span class="math display">\[
\frac{-f_{1} \pm \sqrt{f_{1}^{2} - 4f_{2}p_{1}}}{2f_{1}}
\]</span></p>
<p>We can use a numerical example to make this more concrete. Define:</p>
<p><span class="math display">\[
      \mathbf{A} = \left[ \begin{array}{cc}
    1.5  &amp; 2  \\
    0.5 &amp; 0
   \end{array} \right]
\]</span></p>
<p><span class="math display">\[
\det (\mathbf{A} - \lambda \mathbf{I}) = \left[ \begin{array}{cc}
    1.5 - \lambda   &amp; 2  \\
    0.5 &amp; - \lambda  
  \end{array} \right]
\]</span></p>
<p><span class="math display">\[ \lambda^{2} - 1.5 \lambda - 1 = 0 \]</span></p>
<p><span class="math display">\[ (\lambda - 2)(\lambda + 0.5) = 0 \]</span></p>
<p>Matrix <span class="math inline">\(\mathbf{A}\)</span> has two roots: <span class="math inline">\(\lambda=2\)</span> and <span class="math inline">\(\lambda=-0.5\)</span>. These roots are known as the <strong>eigenvalues</strong> of matrix <span class="math inline">\(\mathbf{A}\)</span>. One of these eigenvalues is the growth rate of the population, but which one? For this <span class="math inline">\(2 \times 2\)</span> example, there are two roots. For larger matrices, there are more. In fact, there are always as many eigenvalues as there are rows (or columns since we are dealing with square matrices) in the matrix. One could imagine this getting a bit hairy. Thankfully, a handy theorem from linear algebra, known as the Perron-Frobenius theorem, tells us that a square, non-negative matrix that is irreducible and primitive will have a single eigenvalue which is positive, real, and strictly greater than all the others. Our example fulfills these criteria, so we may conclude that the growth rate of this population is <span class="math inline">\(\lambda=2\)</span>. This is reassuring since a negative growth rate is an idea that’s a little hard to fathom – at least for the moment. Note that the eigenvalues are the multiplicative growth factors, not instantaneous rates. A declining population will not have a negative multiplicative growth factor! It will have a value of <span class="math inline">\(1&gt;\lambda&gt;0\)</span>. Take the logarithm of that to get the growth <em>rate</em> and that will be negative.</p>
<p>We began this chapter with the statement that for an age-structured population to grow geometrically, it must maintain constant ratios between its age classes. There is a special vector that goes hand-in-hand with the eigenvalue called, strangely enough, an <strong>eigenvector</strong>. Let’s keep up with our example. Remember that the eigenvalues of this model are <span class="math inline">\(\lambda = 2\)</span> and <span class="math inline">\(\lambda = -0.5\)</span>. That means that we can write our model as:</p>
<p><span class="math display">\[
  \mathbf{A} = \left[ \begin{array}{cc}
      1.5  &amp; 2  \\
      0.5 &amp; 0
  \end{array} \right] \left[ \begin{array}{c}
    n_{1} \\
    n_{2}
  \end{array} \right] = \left[ \begin{array}{c}
    2n_{1} \\
    2n_{2}
   \end{array} \right]
\]</span></p>
<p>We now solve this system to two equations and find that <span class="math inline">\(n_{1} = 4n_{2}\)</span> is a solution. That is, if there are four times the number of stage ones as there are stage twos, the population will grow geometrically.</p>
<section id="projection-the-simplest-form-of-analysis" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="projection-the-simplest-form-of-analysis"><span class="header-section-number">7.4.1</span> Projection, The Simplest Form of Analysis</h3>
<p>Most demographers use matrices primarily for projection of populations into the future. Projection is in fact the simplest form of analysis of a population model. When you make a projection, you ask the question: “How big will the population be if the following rates apply for the next <span class="math inline">\(t\)</span> years?” Your projection will only apply to the specific assumptions you build into it, but it may nonetheless yield more general, qualitative insight.</p>
<p>Consider the following plot of a population that does not start off in its stable age distribution. Even though the rates remain constant, the population oscillates around its general upward trajectory. If we let it run long enough, the oscillations dampen and we see the straight line on semilog axes, indicating geometric increase.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>px <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">92</span>,.<span class="dv">95</span>,.<span class="dv">95</span>,.<span class="dv">95</span>,.<span class="dv">95</span>,.<span class="dv">95</span>) <span class="co"># some arbitrary survival probs.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>mx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">05</span>,.<span class="dv">1</span>,.<span class="dv">25</span>,.<span class="dv">5</span>,<span class="dv">1</span>)     <span class="co"># some arbitrary fertilities</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>lx <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,px)                    <span class="co"># a quick way to get lx from px</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>lx <span class="ot">&lt;-</span> <span class="fu">cumprod</span>(lx)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(lx<span class="sc">*</span>mx)                       <span class="co"># the net reproduction number</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.410478</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">length</span>(px)<span class="sc">+</span><span class="dv">1</span>                <span class="co"># i.e., 7</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>A <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow=</span>k, <span class="at">ncol=</span>k)   <span class="co"># make a 7x7 matrix of zeros</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>A[<span class="fu">row</span>(A) <span class="sc">==</span> <span class="fu">col</span>(A)<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> px      <span class="co"># put px on the subdiag</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>A[<span class="dv">1</span>,] <span class="ot">&lt;-</span> mx                      <span class="co"># put mx on first row</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="do">## now project</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># initial population vector</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>no <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>),<span class="at">nrow=</span><span class="dv">7</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> no</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># initiate a matrix to hold the projections</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># add initial population</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">cbind</span>(N,pop)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># number of time steps to project</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>tmax <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># projection</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>tmax){</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  pop <span class="ot">&lt;-</span> A <span class="sc">%*%</span> pop</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">cbind</span>(N,pop)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="do">## plot</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>,<span class="fu">log</span>(<span class="fu">apply</span>(N,<span class="dv">2</span>,sum)),<span class="at">type=</span><span class="st">"l"</span>,<span class="at">col=</span><span class="st">"blue"</span>, <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Time"</span>, <span class="at">ylab=</span><span class="st">"log(Population Size)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="demog2_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The population, which starts very far away from a stable age distribution, oscillates for a about 40 time periods before it settles into geometric growth (linear on a log scale).</p>
</section>
</section>
<section id="constructing-a-leslie-matrix" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="constructing-a-leslie-matrix"><span class="header-section-number">7.5</span> Constructing a Leslie Matrix</h2>
<p>That example is cute, but we want to know how to construct Leslie matrices from actual demographic data.</p>
<p>Not gonna lie: the accounting to make a Leslie matrix is a bit hairy in its details. Conceptually, however, it is simple. The first row of the matrix contains the fertility elements. The subdiagonal contains the survival elements. How we move from demographic data to matrix elements is a bit tricky, but not actually difficult.</p>
<p>A good thing to get out of the way deals with age classes. We typically index the matrix entries with <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span>, such that <span class="math inline">\(a_{ij}\)</span> is the movement from column-index <span class="math inline">\(j\)</span> to row-index <span class="math inline">\(i\)</span>. The data that we draw from a life table and tabulated age-specific fertility data are typically indexed with an <span class="math inline">\(x\)</span>, such that <span class="math inline">\(_nL_x\)</span> is the person-years lived between <span class="math inline">\(x\)</span> and <span class="math inline">\(x+n\)</span>. Let’s just call it like it is and note that the conversion is bound to be awkward. If, as usual, the age at the start of the age class is <span class="math inline">\(x\)</span> and the width of the age interval is <span class="math inline">\(n\)</span>, then <span class="math inline">\(x = (j-1)\, n\)</span>. Survival from age-class one to age-class two is thus <span class="math inline">\(P_1\)</span> as the index 1 corresponds to <span class="math inline">\((2-1) \cdot 5 = 5\)</span>. For the fertility elements, <span class="math inline">\(F_3\)</span> is the fertility of 10-14 year olds (hopefully zero).</p>
<section id="subdiagonal" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1" class="anchored" data-anchor-id="subdiagonal"><span class="header-section-number">7.5.1</span> Subdiagonal</h3>
<p>The subdiagonal elements of our square matrix are the survival probabilities of moving from the column index to the row index. However, the fact that our age classes are typically greater than one year means we need to think a bit harder about how we calculate these probabilities. Suppose we have five-year age classes (which is common). This means that there are actually five one-year cohorts who contribute to each age class in our projection model. Suppose we want the survival probability moving from the second to the third age class in a matrix with five-year age classes (i.e., <span class="math inline">\(a_{32}\)</span>, which moves individuals from age 5 to age 10). In terms of our life-table survivorship values, the size of the youngest cohort in the starting age class will be <span class="math inline">\(l_5\)</span> and the size of the oldest cohort will be <span class="math inline">\(l_10\)</span>. The average of these two is <span class="math inline">\((l_5 + l_10)/2\)</span>, and the width of the interval is five years, so we have <span class="math inline">\(5/2(l_5+l_10)\)</span>. This is the approximation we use in constructing person-years lived for the age class 5-9, <span class="math inline">\(_5L_5\)</span>. The same logic applies to the receiving age class, so the transition probability is <span class="math inline">\(P_2 = {_5}L_{10}/{_5}L_5\)</span> (note the subscript of 2 means this is the survival to the second age class in our model, which is divided into five-year intervals; <span class="math inline">\(5 \times 2 = 10\)</span>, the receiving age).</p>
<p>The general rule then is simply that the subdiagonal elements of the Leslie matrix are:</p>
<p><span class="math display">\[
a_{i+1,i} = \frac{_nL_{i+1}}{_nL_i},
\]</span></p>
<p>the ratio of the person-years lived in the receiving age class to the person-years lived in the sending age class.</p>
</section>
<section id="first-row" class="level3" data-number="7.5.2">
<h3 data-number="7.5.2" class="anchored" data-anchor-id="first-row"><span class="header-section-number">7.5.2</span> First Row</h3>
<p>Alas, the fertility values along the first row are even hairier. In a nutshell, fertility rates can change quite rapidly with respect to even modestly-wide age intervals. This means we need to do some averaging across successive age classes. Note that this averaging involves more than just fertility as well, since a certain fraction of women, who may have reproduced, will die before reaching the next age class. We also know that infancy is the most dangerous year in the human life cycle, so we need to account for the fact that a woman may have given birth multiple times, and lost some of those infants, in a single age class. Finally, the Leslie matrix is typically a one-sex model (two-sex models entail more complex stage-based structure), so we need to transform the observed age-specific fertility rates into female-only fertility rates.</p>
<p>I will not belabor this, while I think about more elegant ways to explain all the steps to constructing the <span class="math inline">\(F_i\)</span> entries. Here’s the general formula, which I’ve tried to write in as compact a form as possible.</p>
<p><span class="math display">\[
F_i = \frac{_nL_0}{2l_0}(m_i + P_i m_{i+1})
\]</span></p>
<p>Some things to note: <span class="math inline">\(m_i\)</span> is the <em>maternity rate</em> in age-class <span class="math inline">\(i\)</span>. It is the product of the age-specific fertility rate <span class="math inline">\(_nF_x\)</span> and the fraction of births that are female (typically a bit under 50%). As noted above <span class="math inline">\(P_i = _nL_{x+1}/{_n}L_x\)</span>. Don’t forget to adjust your fertility rates to represent a single sex or your population growth rates will be way too high!</p>
<p>Remember that <span class="math inline">\(l_0\)</span> is the radix of the life table. This is the size of the synthetic cohort that defines our period life table. We often take <span class="math inline">\(l_0 = 1\)</span>, particularly in biological applications, but demographers conventionally use a radix of <span class="math inline">\(l_0=100000\)</span>. <span class="math inline">\(_nL_0\)</span>, of course, is the person-years lived in the first age-class.</p>
</section>
<section id="fun-facts-about-eigenvalues" class="level3" data-number="7.5.3">
<h3 data-number="7.5.3" class="anchored" data-anchor-id="fun-facts-about-eigenvalues"><span class="header-section-number">7.5.3</span> Fun facts about Eigenvalues</h3>
<p>The Perron-Frobenius Theorem guarantees that one eigenvalue will be real, positive and absolutely greater than all others. This is called the <strong>dominant eigenvalue</strong> of the projection matrix. The dominant eigenvalue of the projection matrix is the asymptotic growth rate of the population described by that matrix. The dominant eigenvalue of the projection matrix is also the fitness measure of choice for age-structured populations. <span class="math inline">\(\log(\lambda)/n = r\)</span>. That is, the natural logarithm of the dominant eigenvalue, divided by the length of the projection interval (or age class), gives the annual rate of increase of the population. By calculating the eigenvalues of a projection matrix, you get lots of other important information.</p>
</section>
</section>
<section id="left-eigenvectors-of-the-projection-matrix" class="level2" data-number="7.6">
<h2 data-number="7.6" class="anchored" data-anchor-id="left-eigenvectors-of-the-projection-matrix"><span class="header-section-number">7.6</span> Left Eigenvectors of the Projection Matrix</h2>
<p>In matrix algebra, multiplication is not commutative, <span class="math inline">\(\mathbf{A B} \neq \mathbf{B A}\)</span>. Thus, the left eigenvector of a matrix is distinct from the right eigenvector:</p>
<p><span class="math display">\[
    \mathbf{v}^{*}\mathbf{A} = \lambda\mathbf{v}^{*},
\]</span></p>
<p>where the asterisk denotes the complex-conjugate transpose.</p>
<p>Define <span class="math inline">\(\mathbf{U}\)</span> as a matrix of eigenvectors where each column <span class="math inline">\(i\)</span> is the <span class="math inline">\(i\)</span>th eigenvector of <span class="math inline">\(\mathbf{A}\)</span>, and <span class="math inline">\(\mathbf{\Lambda}\)</span> as a matrix with the eigenvalues of <span class="math inline">\(\mathbf{A}\)</span> along the diagonal and zeros elsewhere, we have</p>
<p><span class="math display">\[
\begin{align}
    \mathbf{A U}  &amp; =  \mathbf{U \Lambda}  \\
    \mathbf{\Lambda}&amp; =  \mathbf{U^{-1} A U} \\
    \mathbf{U^{-1} A} &amp; =  \mathbf{\Lambda U^{-1}}
\end{align}
\]</span></p>
<p>This is the matrix formula for an eigensystem, suggesting that the rows of <span class="math inline">\(\mathbf{U^{-1}}\)</span> must be the left eigenvectors of <span class="math inline">\(\mathbf{A}\)</span>.</p>
<p>The left eigenvector, corresponding to the dominant eigenvalue, of a demographic projection matrix has a particular interpretation. It represents the age-specific <strong>reproductive value</strong> of the population. The reproductive value of the <span class="math inline">\(i\)</span>th age class is the expected contribution of individuals age <span class="math inline">\(i\)</span> to the population in the distant future. This is an important concept in evolutionary biology which we take up repeatedly.</p>
</section>
<section id="spectral-decomposition-of-the-projection-matrix" class="level2" data-number="7.7">
<h2 data-number="7.7" class="anchored" data-anchor-id="spectral-decomposition-of-the-projection-matrix"><span class="header-section-number">7.7</span> Spectral Decomposition of the Projection Matrix</h2>
<p>What do we mean by reproductive value being the contribution to the population in the distant future? Suppose we are given an initial population vector, <span class="math inline">\(\mathbf{n}(0)\)</span>. We can write <span class="math inline">\(\mathbf{n}(0)\)</span> as a linear combination of of the right eigenvectors, <span class="math inline">\(\mathbf{u}_i\)</span> of the projection matrix <span class="math inline">\(\mathbf{A}\)</span>.</p>
<p><span class="math display">\[
\mathbf{n}(0) = c_1 \mathbf{u}_1 + c_2 \mathbf{u}_2 + \cdots + c_k \mathbf{u}_k
\]</span></p>
<p>where the <span class="math inline">\(c_i\)</span> are a set of coefficients.</p>
<p>We can collect the eigenvectors into a matrix where each column <span class="math inline">\(i\)</span> is simply the <span class="math inline">\(i\)</span>th eigenvecotr and the coefficients into a vector and re-write this equation as:</p>
<p><span class="math display">\[
\mathbf{n}(0) = \mathbf{U} \mathbf{c}.
\]</span></p>
<p>From this, it is clear that <span class="math inline">\(\mathbf{c} = \mathbf{U}^{-1} \mathbf{n}(0)\)</span>. <span class="math inline">\(\mathbf{U}^{-1}\)</span> is just the matrix of left eigenvectors (or their complex-conjugate transpose), so <span class="math inline">\(c_i = \bf{v}_i^* \mathbf{n}(0)\)</span>.</p>
<p>Project the initial population vector <span class="math inline">\(\mathbf{n}(0)\)</span> forward by multiplying it by the projection matrix <span class="math inline">\(\mathbf{A}\)</span>:</p>
<p><span class="math display">\[
\begin{align}
  \mathbf{n}(1) &amp; =  \mathbf{A} \mathbf{n}(0) \\
  \mbox{} &amp; =  \sum_i c_i \mathbf{A} \mathbf{u}_i \\
  \mbox{} &amp; =  \sum_i c_i \lambda_i \mathbf{u}_i
\end{align}
\]</span></p>
<p>Multiply again!</p>
<p><span class="math display">\[
\begin{align}
  \mathbf{n}(2) &amp; =  \mathbf{A} \mathbf{n}(1) \\
  \mbox{} &amp; =  \sum_i c_i \lambda_i \mathbf{A} \mathbf{u}_i \\
  \mbox{} &amp; =  \sum_i c_i \lambda_i^2 \mathbf{u}_i
\end{align}
\]</span></p>
<p>We could keep going, but at this point it isn’t hard to believe that the following holds:</p>
<p><span class="math display">\[
  \mathbf{n}(t) = \sum_i c_i \lambda_i^t \mathbf{u}_i
\]</span></p>
<p>This is equivalent to:</p>
<p><span class="math display">\[
  \mathbf{n}(t) = \sum_i \lambda_i^t \mathbf{u}_i \bf{v}_i^* \mathbf{n}(0)
\]</span></p>
<p>This is known as the <strong>Spectral Decomposition</strong> of the projection matrix <span class="math inline">\(\mathbf{A}\)</span></p>
<p>It is instructive to compare this to the solution for population growth in an unstructured (i.e., scalar) population, characterized by a geometric rate of increase <span class="math inline">\(a\)</span> for one time step</p>
<p><span class="math display">\[ N(t+1) = a N(t), \]</span> and for an arbitrary number of steps</p>
<p><span class="math display">\[ N(t) = N(0) a^t. \]</span></p>
<p>For the scalar case, the solution is exponential. For a <span class="math inline">\(k\)</span>-dimensional matrix, this solution means that the population size at time <span class="math inline">\(t\)</span> is a weighted sum of <span class="math inline">\(k\)</span> exponentials. While both depend on the initial conditions, the <span class="math inline">\(k\)</span>-dimensional case weights the initial population vector by the reproductive values of the <span class="math inline">\(k\)</span> classes.</p>
</section>
<section id="matrix-perturbations" class="level2" data-number="7.8">
<h2 data-number="7.8" class="anchored" data-anchor-id="matrix-perturbations"><span class="header-section-number">7.8</span> Matrix Perturbations</h2>
<p>This derivation follows Caswell (2001). As a note of interest, I took the first edition (1989) of Caswell’s book to the field in Borneo with me as a graduate student. I still have that book. It smells like rainforest. I have Hal to thank for much of what I know about matrix population models and population biology more generally. We start from the general matrix population model:</p>
<p><span class="math display">\[
    \mathbf{A u} = \lambda \mathbf{u}
\]</span></p>
<p>Now we perturb the system, adding a scootch to each of the terms</p>
<p><span class="math display">\[
    (\mathbf{A} + d\mathbf{A}) (\mathbf{u} + d\mathbf{u}) =
    (\lambda + d\lambda) (\mathbf{u} + d\mathbf{u})
\]</span></p>
<p>Multiply all the products and discard the second-order terms such as <span class="math inline">\((d\mathbf{A})(d\mathbf{u})\)</span>—squared scootches are small enough to ignore.</p>
<p><span class="math display">\[
    \mathbf{A w} + \mathbf{A}(d\mathbf{u}) + (d\mathbf{A})\mathbf{u}  =
    \lambda \mathbf{u} + \lambda(d\mathbf{u}) + (d\lambda) \mathbf{u}.
\]</span></p>
<p>Simplify this to yield</p>
<p><span class="math display">\[
    \mathbf{A}(d\mathbf{u}) + (d\mathbf{A}) \mathbf{u}  =
    \lambda (d\mathbf{u}) + (d\lambda) \mathbf{u}.
\]</span></p>
<p>Multiply both sides by <span class="math inline">\(\mathbf{v^{*}}\)</span> to get</p>
<p><span class="math display">\[
    \mathbf{v^{*}}\mathbf{A}(d\mathbf{u}) +
    \mathbf{v^{*}}(d\mathbf{A}) \mathbf{u} = \lambda \mathbf{v^{*}}
    (d\mathbf{u}) + \mathbf{v^{*}} (d\lambda) \mathbf{u}.
\]</span></p>
<p>From the definition of a left eigenvector, we know that the first term on the left-hand side is the same as the first term on the right-hand side. Similarly, because the right and left eigenvectors are scaled so that <span class="math inline">\(\langle \mathbf{w,v} \rangle = 1\)</span>, the last term simplifies to <span class="math inline">\(d\lambda\)</span>. We are left with</p>
<p><span class="math display">\[
    \mathbf{v^{*}} d\mathbf{A} \mathbf{u} = d\lambda.
\]</span></p>
<p>When we do a perturbation analysis, we typically only change a single element of <span class="math inline">\(\mathbf{A}\)</span>. Thus the basic formula for the sensitivity of the dominant eigenvalue to a small change in element <span class="math inline">\(a_{ij}\)</span> is</p>
<p><span class="math display">\[
    \frac{\partial \lambda}{\partial a_{ij}} = v_{i} u_{j}.
\]</span></p>
<p>In other words, the sensitivity of fitness to a small change in projection matrix element <span class="math inline">\(a_{ij}\)</span> is simply the <span class="math inline">\(i\)</span>th element of the left eigenvector weighted by the proportion of the stable population in the <span class="math inline">\(j\)</span>th class (assuming vectors have been normed such that <span class="math inline">\(\langle \mathbf{v,u} \rangle =1\)</span>). Keep that in mind.</p>
<p>Eigenvalue Sensitivities are Linear Estimates of the Change in <span class="math inline">\(\lambda_1\)</span>, Given a Perturbation, as illustrated in the following figure. Here, we will recycle and modify our code from discussion of the marginal value theorem in chapter <a href="drawing.html" class="quarto-xref"><span>Chapter 3</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">18</span>,<span class="at">length=</span><span class="dv">500</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># fitness is an unknown function, but probably fp&gt; 0 fpp &lt; 0</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fp == deriv of f; fpp == 2nd deriv of f</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.2</span><span class="sc">*</span>(x<span class="dv">-1</span>))</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># derivative of the utility function</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>fprime <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="fl">0.2</span><span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span><span class="fl">0.2</span><span class="sc">*</span>x)<span class="sc">*</span><span class="fu">exp</span>(<span class="fl">0.2</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co"># f + fp*(z-x) = 0</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># z = x -(f/fp)</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># solve for tangency; find the root of this</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>xinter <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x <span class="sc">-</span> <span class="fu">f</span>(x)<span class="sc">/</span><span class="fu">fprime</span>(x))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>soln <span class="ot">&lt;-</span> <span class="fu">uniroot</span>(xinter,<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">10</span>))</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">#xx &lt;- seq(7,10,length=100)</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,<span class="fu">f</span>(x), <span class="at">type=</span><span class="st">"l"</span>, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">xaxs=</span><span class="st">"i"</span>, <span class="at">yaxs=</span><span class="st">"i"</span>,</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>     <span class="at">axes=</span><span class="cn">FALSE</span>, <span class="at">frame=</span><span class="cn">TRUE</span>,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="fu">expression</span>(a[ij]),</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="fu">expression</span>(lambda),</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(x,(<span class="fu">f</span>(soln<span class="sc">$</span>root)<span class="sc">/</span>soln<span class="sc">$</span>root)<span class="sc">*</span>x,<span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(soln<span class="sc">$</span>root,<span class="dv">0</span>,soln<span class="sc">$</span>root,<span class="fu">f</span>(soln<span class="sc">$</span>root), <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(<span class="dv">0</span>,<span class="fu">f</span>(soln<span class="sc">$</span>root),soln<span class="sc">$</span>root,<span class="fu">f</span>(soln<span class="sc">$</span>root), <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="demog2_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Note that because I was recycling code, I kludged a bit. It’s a schemaic plot, so the values on the axes are meaningless, so I suppressed them using <code>axes=FALSE</code> and <code>frame=TRUE</code>.</p>
<p>The black curve is a hypothetical fitness function of the matrix element <span class="math inline">\(a_{ij}\)</span>. Presumably, in the absence of any trade-offs, an increase in this matrix element should increase fitness (those elements are survival probabilities and fertility rates, after all). However, we expect diminishing marginal improvement as we increase the value by a lot. Hence, the curve is concave. The red solid line is a tangent to the curve. It is a linear approximation of the slope of the curve at the value of <span class="math inline">\(a_{ij}\)</span>. For small perturbations, this should provide a decent measure of how much fitness will change. Note that the black line is, in fact, quite linear for the region around its observed value (dashed red lines), such that it’s hard to tell exactly where the tangent hits without those dashed lines.</p>
</section>
<section id="elasticities" class="level2" data-number="7.9">
<h2 data-number="7.9" class="anchored" data-anchor-id="elasticities"><span class="header-section-number">7.9</span> Elasticities</h2>
<p>Another measure of the change in a matrix given a small change in an underlying element is the eigenvalue elasticity:</p>
<p><span class="math display">\[ e_{ij} = \frac{\partial \log \lambda}{\partial \log a_{ij}}. \]</span></p>
<p>Elasticities are proportional sensitivities: they measure the linear change on a log scale. Given a 1% change in vital rate <span class="math inline">\(a_{ij}\)</span> what percentage change will accompany <span class="math inline">\(\lambda\)</span>? This is an elasticity. A very important property of elasticities is that they sum to one: <span class="math inline">\(\sum_{i,j} e_{ij} = 1\)</span>. As such, one can think of the elasticity of <span class="math inline">\(\lambda\)</span> with respect to <span class="math inline">\(a_{ij}\)</span> as measuring the proportion of the total selection on that trait. This interpretation is somewhat limited because it is conditioned on all other traits remaining constant and on the change being small.</p>
<p>Another interesting property of elasticities is that the summed elasticities of all outgoing transitions from a stage will be equal to the summed elasticities of all incoming transitions. In terms of the projection matrix, this means that the elasticities of all elements in column <span class="math inline">\(i\)</span> will be equal to the summed elasticities of row <span class="math inline">\(i\)</span>. It also provides us with some intuition about why the elasticities of fertility are so much lower than the elasticities of survival, at least earlier in the reproductive career.</p>
<p><img src="figures/elas-demo.png" class="img-fluid" alt="The elasticity of a survival transition to a reproductive age is equal to the sum of the elasticities of the outgoing survival and the fertility transitions, in an age-structured model"> This fact also provides inuition about why the elasticity of pre-reproductive survival (especially infant survival) is so high.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figures/elas-age1.png" class="img-fluid figure-img"></p>
<figcaption>The elasticity of infant survival is equal to the sum of all the fertility elasticities. Moreover, the elasticity of subsequent, pre-reproductive survival is the same as all prior previous survival elasticities in the life cycle.</figcaption>
</figure>
</div>
<section id="relationship-to-hamilton" class="level3" data-number="7.9.1">
<h3 data-number="7.9.1" class="anchored" data-anchor-id="relationship-to-hamilton"><span class="header-section-number">7.9.1</span> Relationship to Hamilton</h3>
<p>The elasticities of the sub-diagonal elements of the Leslie matrix (i.e., the <span class="math inline">\(P_i\)</span> from the life-cycle graph) are essentially the same thing that Hamilton (1966) calculates by differentiating the discrete-time Euler-Lotka equation. A major advantage of the matrix approach is the ease with which the sensitivities and elasticities can be calculated. Furthermore, the approach is easily extended to other types of structured models (i.e., not just age-structure) and to related measures such as the second derivatives of fitness, which provide an estimate the form of selection (stabilizing, directional).</p>
<p>Conceptually, it is illuminating to think of the force of selection on a given life-cycle transition as being simply a product of the reproductive value of the receiving stage and the fraction of the stable age distribution from the sending stage.</p>
</section>
</section>
<section id="calculating-sensitivities" class="level2" data-number="7.10">
<h2 data-number="7.10" class="anchored" data-anchor-id="calculating-sensitivities"><span class="header-section-number">7.10</span> Calculating Sensitivities</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Matrix A from above</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate eigenvalues/eigenvectors</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>ev <span class="ot">&lt;-</span> <span class="fu">eigen</span>(A)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># need to make sure we get the dominant eigenvalue</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>lmax <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">Re</span>(ev<span class="sc">$</span>values)<span class="sc">==</span><span class="fu">max</span>(<span class="fu">Re</span>(ev<span class="sc">$</span>values)))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># take real part (imaginary part will be zero anyway)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">Re</span>(ev<span class="sc">$</span>values[lmax])</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># right eigenvectors</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> ev<span class="sc">$</span>vectors</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co"># dominant right eigenvector</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">Re</span>(U[,lmax]))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># left eigenvectors are the complex conjugate transpose of the inverse of U</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">Conj</span>(<span class="fu">solve</span>(U))</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># dominant left eigenvector</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">Re</span>(V[lmax,]))</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="co"># outer product of v and u</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> v<span class="sc">%o%</span>u</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivities of non-existent transitions are zero </span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>s[A <span class="sc">==</span> <span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          [,1]     [,2]      [,3]      [,4]      [,5]       [,6]       [,7]
[1,] 0.0000000 0.000000 0.1283009 0.1152267 0.1034848 0.09293949 0.08346873
[2,] 0.1888559 0.000000 0.0000000 0.0000000 0.0000000 0.00000000 0.00000000
[3,] 0.0000000 0.182892 0.0000000 0.0000000 0.0000000 0.00000000 0.00000000
[4,] 0.0000000 0.000000 0.1761393 0.0000000 0.0000000 0.00000000 0.00000000
[5,] 0.0000000 0.000000 0.0000000 0.1640102 0.0000000 0.00000000 0.00000000
[6,] 0.0000000 0.000000 0.0000000 0.0000000 0.1367773 0.00000000 0.00000000
[7,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.08786182 0.00000000</code></pre>
</div>
</div>
<p>That’s cool. A plot would be better.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>surv_sens <span class="ot">&lt;-</span> s[<span class="fu">row</span>(A)<span class="sc">==</span><span class="fu">col</span>(A)<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, surv_sens, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">lwd=</span><span class="dv">3</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="fl">0.05</span>,<span class="fl">0.2</span>), <span class="at">xlab=</span><span class="st">"Age"</span>, <span class="at">ylab=</span><span class="st">"Sensitivity"</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>,s[<span class="dv">1</span>,<span class="dv">4</span><span class="sc">:</span><span class="dv">7</span>], <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="demog2_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Sensitivities of survival are generally higher than those for fertility, except for the last age class. Survival and fertility sensitivities decline with age, but the decline is more pronounced for survival.</p>
<p>Let’s do something a little more interesting. We’ll calculate mortality and fertility schedules from the three countries in the <code>goodman</code> data in my package <code>demogR</code>. We can then use those data to construct Leslie matrices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(demogR)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(goodman)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Madagascar</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>mlt <span class="ot">&lt;-</span> <span class="fu">with</span>(goodman, <span class="fu">life.table</span>(<span class="at">x=</span>age, <span class="at">nDx=</span>mad.nDx, <span class="at">nKx=</span>mad.nKx))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>mmx <span class="ot">&lt;-</span> goodman<span class="sc">$</span>mad.bx<span class="sc">/</span>goodman<span class="sc">$</span>mad.nKx</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Venezuela</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>vlt <span class="ot">&lt;-</span> <span class="fu">with</span>(goodman, <span class="fu">life.table</span>(<span class="at">x=</span>age, <span class="at">nDx=</span>ven.nDx, <span class="at">nKx=</span>ven.nKx))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>vmx <span class="ot">&lt;-</span> goodman<span class="sc">$</span>ven.bx<span class="sc">/</span>goodman<span class="sc">$</span>ven.nKx</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="do">## USA</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>ult <span class="ot">&lt;-</span> <span class="fu">with</span>(goodman, <span class="fu">life.table</span>(<span class="at">x=</span>age, <span class="at">nDx=</span>usa.nDx, <span class="at">nKx=</span>usa.nKx))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>umx <span class="ot">&lt;-</span> goodman<span class="sc">$</span>usa.bx<span class="sc">/</span>goodman<span class="sc">$</span>usa.nKx</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="do">## Now make the Leslie matrices</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>mad <span class="ot">&lt;-</span> <span class="fu">leslie.matrix</span>(<span class="at">lx=</span>mlt<span class="sc">$</span>nLx, <span class="at">mx=</span>mmx)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>ven <span class="ot">&lt;-</span> <span class="fu">leslie.matrix</span>(<span class="at">lx=</span>vlt<span class="sc">$</span>nLx, <span class="at">mx=</span>vmx)</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>usa <span class="ot">&lt;-</span> <span class="fu">leslie.matrix</span>(<span class="at">lx=</span>ult<span class="sc">$</span>nLx, <span class="at">mx=</span>umx)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate everything using eigen.analysis function in demogR</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>mea <span class="ot">&lt;-</span> <span class="fu">eigen.analysis</span>(mad)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>vea <span class="ot">&lt;-</span> <span class="fu">eigen.analysis</span>(ven)</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>uea <span class="ot">&lt;-</span> <span class="fu">eigen.analysis</span>(usa)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="do">## you can plot leslie.matrix objects in demogR</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mea<span class="sc">$</span>sens, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>), <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,<span class="fu">c</span>(<span class="st">"survival"</span>,<span class="st">"fertility"</span>),<span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>))</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Madagascar"</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="do">## ven</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vea<span class="sc">$</span>sens, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>), <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,<span class="fu">c</span>(<span class="st">"survival"</span>,<span class="st">"fertility"</span>),<span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>))</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Venezuela"</span>)</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="do">## usa</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(uea<span class="sc">$</span>sens, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>), <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,<span class="fu">c</span>(<span class="st">"survival"</span>,<span class="st">"fertility"</span>),<span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>))</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"USA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="demog2_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Compare the sensitivities to the elasticities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">## you can plot leslie.matrix objects in demogR</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mea<span class="sc">$</span>elas, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>), <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,<span class="fu">c</span>(<span class="st">"survival"</span>,<span class="st">"fertility"</span>),<span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Madagascar"</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="do">## ven</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vea<span class="sc">$</span>elas, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>), <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,<span class="fu">c</span>(<span class="st">"survival"</span>,<span class="st">"fertility"</span>),<span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Venezuela"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="do">## usa</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(uea<span class="sc">$</span>elas, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>), <span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,<span class="fu">c</span>(<span class="st">"survival"</span>,<span class="st">"fertility"</span>),<span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"magenta4"</span>))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"USA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="demog2_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hal Caswell has an <a href="https://doi.org/10.1007/978-3-030-10534-1_1">open-access text</a> on sensitivity analysis and matrix methods in demography.</p>
</section>
<section id="some-demographic-analysis" class="level2" data-number="7.11">
<h2 data-number="7.11" class="anchored" data-anchor-id="some-demographic-analysis"><span class="header-section-number">7.11</span> Some Demographic Analysis</h2>
<p>These are four populations that span what I’ve called the human demographic space (Jones 2009): Ache, and !Kung hunter-gatherers, Venezuela from 1965, and the USA from 2002. I show a plot of this space in chapter <a href="interpreting.html" class="quarto-xref"><span>Chapter 2</span></a>. The data are somewhat heterogeneous. Venezuela come from tabulated values of deaths, births, and exposed populations listed in the demographic compendium of Keyfitz &amp; Flieger (1971). The USA mortality data come from HMD and the ASFR data come from the US Census Bureau web site (cited in Jones 2009). Both mortality and fertility data for the !Kung and Ache come from the monographs by Howell (1979) and Hill &amp; Hurtado (1994) respectively.</p>
<p>The code that follows is necessarily a bit messy because the data are a little different for each population. What I do is get the data necessary to construct Leslie matrices with five-year age classes. I then use smoothing splines to interpolate one-year values. This meant I was able to plot smoother curves in the 2009 paper, among other things. Interpolating with splines is a good trick to have in your toolkit, regardless.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(demogR)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## load the heterogeneous data</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"./data/demog_data_4pops.R"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ache</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>ache.lt <span class="ot">&lt;-</span> <span class="fu">life.table</span>(<span class="at">x=</span>ache.age,<span class="at">nDx=</span>ache.nDx,<span class="at">nKx=</span>ache.nKx,<span class="at">type=</span><span class="st">"cd"</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>ache.lx <span class="ot">&lt;-</span> ache.lt[,<span class="st">"lx"</span>]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="do">## fit the splines</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>alxspl <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(ache.lt<span class="sc">$</span>x,ache.lt<span class="sc">$</span>lx)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="do">## interpolate to one-year values</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>alx1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(alxspl,<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">$</span>y</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="do">## calculate px values from lx</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>apx <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">diff</span>(<span class="fu">log</span>(alx1)))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="do">## fit splines to fertility</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>amxspl <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">45</span>,<span class="at">by=</span><span class="dv">5</span>), ache.mx<span class="sc">/</span><span class="dv">5</span>)</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="do">## interpolate to one-year values</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>mx1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(amxspl, <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">$</span>y</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># replace any negative values with zero</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>mx1[mx1<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="do">## construct 50 x 50 Leslie matrix</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="do">## uses demogR functions leslie.row1 and odiag; also eigen.analysis</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">leslie.row1</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">9</span>),mx1),<span class="at">px=</span>apx,<span class="at">SRB=</span><span class="dv">1</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>ales <span class="ot">&lt;-</span> <span class="fu">odiag</span>(apx[<span class="dv">1</span><span class="sc">:</span><span class="dv">46</span>],<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>ales[<span class="dv">1</span>,] <span class="ot">&lt;-</span> r1[<span class="dv">1</span><span class="sc">:</span><span class="dv">47</span>]</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>ea.ache <span class="ot">&lt;-</span> <span class="fu">eigen.analysis</span>(ales)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivities</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>asf <span class="ot">&lt;-</span> ea.ache<span class="sc">$</span>sensitivities[<span class="dv">1</span>,]</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>ass <span class="ot">&lt;-</span> ea.ache<span class="sc">$</span>sensitivities[<span class="fu">row</span>(ales) <span class="sc">==</span> <span class="fu">col</span>(ales)<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co"># elasticities</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>aef <span class="ot">&lt;-</span> ea.ache<span class="sc">$</span>elasticities[<span class="dv">1</span>,]</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>aes <span class="ot">&lt;-</span> ea.ache<span class="sc">$</span>elasticities[<span class="fu">row</span>(ales) <span class="sc">==</span> <span class="fu">col</span>(ales)<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="do">## !Kung</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>klxspl <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(kung.age[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>],kung.lx[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>])</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>klx1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(klxspl,<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">$</span>y</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>kpx <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">diff</span>(<span class="fu">log</span>(klx1)))</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co"># fertility</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>kmxspl <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="fu">seq</span>(<span class="dv">15</span>,<span class="dv">45</span>,<span class="at">by=</span><span class="dv">5</span>), kung.mx<span class="sc">/</span><span class="dv">5</span>)</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>kmx1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(kmxspl, <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">$</span>y</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>kmx1[kmx1<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Leslie matrix</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">leslie.row1</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">9</span>),kmx1),<span class="at">px=</span>kpx,<span class="at">SRB=</span><span class="dv">1</span>)</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>kles <span class="ot">&lt;-</span> <span class="fu">odiag</span>(kpx[<span class="dv">1</span><span class="sc">:</span><span class="dv">46</span>],<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>kles[<span class="dv">1</span>,] <span class="ot">&lt;-</span> r1[<span class="dv">1</span><span class="sc">:</span><span class="dv">47</span>]</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>ea.kung <span class="ot">&lt;-</span> <span class="fu">eigen.analysis</span>(kles)</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivities</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>ksf <span class="ot">&lt;-</span> ea.kung<span class="sc">$</span>sensitivities[<span class="dv">1</span>,]</span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>kss <span class="ot">&lt;-</span> ea.kung<span class="sc">$</span>sensitivities[<span class="fu">row</span>(kles) <span class="sc">==</span> <span class="fu">col</span>(kles)<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="co"># elasticities</span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>kef <span class="ot">&lt;-</span> ea.kung<span class="sc">$</span>elasticities[<span class="dv">1</span>,]</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>kes <span class="ot">&lt;-</span> ea.kung<span class="sc">$</span>elasticities[<span class="fu">row</span>(kles) <span class="sc">==</span> <span class="fu">col</span>(kles)<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="do">## USA and Venezuela have death, birth, exposure data, so create life tables</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="do">## USA</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>usa.lt <span class="ot">&lt;-</span> <span class="fu">life.table</span>(<span class="at">x=</span>usa.age,<span class="at">nDx=</span>usa.nDx,<span class="at">nKx=</span>usa.nKx)</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>usa.lx <span class="ot">&lt;-</span> usa.lt[,<span class="st">"lx"</span>]</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>usa.nMx <span class="ot">&lt;-</span> usa.lt[,<span class="st">"nMx"</span>]</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>usa.age <span class="ot">&lt;-</span> usa.lt[,<span class="st">"x"</span>]</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>ulxspl <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(usa.age,usa.lx)</span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>ulx1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(ulxspl,<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">$</span>y</span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>upx <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">diff</span>(<span class="fu">log</span>(ulx1)))</span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>usa.mx <span class="ot">&lt;-</span> usa.mx[<span class="dv">4</span><span class="sc">:</span><span class="dv">11</span>]</span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a>umxspl <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="fu">seq</span>(<span class="dv">15</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">5</span>), usa.mx<span class="sc">/</span><span class="dv">5</span>)</span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>umx1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(umxspl, <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">$</span>y</span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>umx1[umx1<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">leslie.row1</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">9</span>),umx1),<span class="at">px=</span>upx,<span class="at">SRB=</span><span class="dv">1</span>)</span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>ules <span class="ot">&lt;-</span> <span class="fu">odiag</span>(upx,<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>ules[<span class="dv">1</span>,] <span class="ot">&lt;-</span> r1</span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="do">### predicted fertilities for ages greater than 49 are NA</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>ules <span class="ot">&lt;-</span> ules[<span class="dv">1</span><span class="sc">:</span><span class="dv">49</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">49</span>]</span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="co"># analysis</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a>ea.usa <span class="ot">&lt;-</span> <span class="fu">eigen.analysis</span>(ules)</span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivities</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>uss <span class="ot">&lt;-</span> ea.usa<span class="sc">$</span>sensitivities[<span class="fu">row</span>(ules) <span class="sc">==</span> <span class="fu">col</span>(ules)<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>usf <span class="ot">&lt;-</span> ea.usa<span class="sc">$</span>sensitivities[<span class="dv">1</span>,]</span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="co"># elasticities</span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>ues <span class="ot">&lt;-</span> ea.usa<span class="sc">$</span>elasticities[<span class="fu">row</span>(ules) <span class="sc">==</span> <span class="fu">col</span>(ules)<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>uef <span class="ot">&lt;-</span> ea.usa<span class="sc">$</span>elasticities[<span class="dv">1</span>,]</span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="do">## Venezuela</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>ven.lt <span class="ot">&lt;-</span> <span class="fu">life.table</span>(<span class="at">x=</span>ven.age, <span class="at">nDx=</span>ven.nDx, <span class="at">nKx=</span>ven.nKx)</span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>ven.lx <span class="ot">&lt;-</span> ven.lt[,<span class="st">"lx"</span>]</span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a>ven.age <span class="ot">&lt;-</span> ven.lt[,<span class="st">"x"</span>]</span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a>vlxspl <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(ven.age,ven.lx)</span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a>vlx1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(vlxspl,<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">$</span>y</span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a>vpx <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fu">diff</span>(<span class="fu">log</span>(vlx1)))</span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a>ven.mx <span class="ot">&lt;-</span> ven.bx<span class="sc">/</span>ven.nKx</span>
<span id="cb10-93"><a href="#cb10-93" aria-hidden="true" tabindex="-1"></a>ven.mx <span class="ot">&lt;-</span> ven.mx[<span class="dv">4</span><span class="sc">:</span><span class="dv">12</span>]</span>
<span id="cb10-94"><a href="#cb10-94" aria-hidden="true" tabindex="-1"></a>vmxspl <span class="ot">&lt;-</span> <span class="fu">smooth.spline</span>(<span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">5</span>), ven.mx<span class="sc">/</span><span class="dv">5</span>)</span>
<span id="cb10-95"><a href="#cb10-95" aria-hidden="true" tabindex="-1"></a>vmx1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(vmxspl, <span class="fu">seq</span>(<span class="dv">10</span>,<span class="dv">50</span>,<span class="at">by=</span><span class="dv">1</span>))<span class="sc">$</span>y</span>
<span id="cb10-96"><a href="#cb10-96" aria-hidden="true" tabindex="-1"></a>vmx1[vmx1<span class="sc">&lt;</span><span class="dv">0</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-97"><a href="#cb10-97" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">leslie.row1</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">9</span>),vmx1),<span class="at">px=</span>vpx,<span class="at">SRB=</span><span class="dv">1</span>)</span>
<span id="cb10-98"><a href="#cb10-98" aria-hidden="true" tabindex="-1"></a>vles <span class="ot">&lt;-</span> <span class="fu">odiag</span>(vpx,<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb10-99"><a href="#cb10-99" aria-hidden="true" tabindex="-1"></a>vles[<span class="dv">1</span>,] <span class="ot">&lt;-</span> r1</span>
<span id="cb10-100"><a href="#cb10-100" aria-hidden="true" tabindex="-1"></a>vles <span class="ot">&lt;-</span> vles[<span class="dv">1</span><span class="sc">:</span><span class="dv">49</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">49</span>]</span>
<span id="cb10-101"><a href="#cb10-101" aria-hidden="true" tabindex="-1"></a><span class="co">#analysis</span></span>
<span id="cb10-102"><a href="#cb10-102" aria-hidden="true" tabindex="-1"></a>ea.ven <span class="ot">&lt;-</span> <span class="fu">eigen.analysis</span>(vles)</span>
<span id="cb10-103"><a href="#cb10-103" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivities</span></span>
<span id="cb10-104"><a href="#cb10-104" aria-hidden="true" tabindex="-1"></a>vsf <span class="ot">&lt;-</span> ea.ven<span class="sc">$</span>sensitivities[<span class="dv">1</span>,]</span>
<span id="cb10-105"><a href="#cb10-105" aria-hidden="true" tabindex="-1"></a>vss <span class="ot">&lt;-</span> ea.ven<span class="sc">$</span>sensitivities[<span class="fu">row</span>(vles) <span class="sc">==</span> <span class="fu">col</span>(vles)<span class="sc">+</span><span class="dv">1</span>]</span>
<span id="cb10-106"><a href="#cb10-106" aria-hidden="true" tabindex="-1"></a><span class="co"># elasticities</span></span>
<span id="cb10-107"><a href="#cb10-107" aria-hidden="true" tabindex="-1"></a>vef <span class="ot">&lt;-</span> ea.ven<span class="sc">$</span>elasticities[<span class="dv">1</span>,]</span>
<span id="cb10-108"><a href="#cb10-108" aria-hidden="true" tabindex="-1"></a>ves <span class="ot">&lt;-</span> ea.ven<span class="sc">$</span>elasticities[<span class="fu">row</span>(vles) <span class="sc">==</span> <span class="fu">col</span>(vles)<span class="sc">+</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can construct some plots. First, let’s plot reproductive value and age structure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot reproductive value</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ea.ache<span class="sc">$</span>repro.value, <span class="at">type=</span><span class="st">"l"</span>, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"blue4"</span>, <span class="at">xaxs=</span><span class="st">"i"</span>, <span class="at">xlab=</span><span class="st">"Age"</span>, <span class="at">ylab=</span><span class="st">"Reproductive Value"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ea.usa<span class="sc">$</span>repro.value, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"red4"</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ea.kung<span class="sc">$</span>repro.value, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"green4"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ea.ven<span class="sc">$</span>repro.value, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topright"</span>,<span class="fu">c</span>(<span class="st">"Ache"</span>,<span class="st">"Venezuela"</span>,<span class="st">"!Kung"</span>,<span class="st">"USA"</span>), <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue4"</span>,<span class="st">"orange"</span>,<span class="st">"green4"</span>,<span class="st">"red4"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="demog2_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot age structure</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(ea.ache<span class="sc">$</span>stable.age, <span class="at">horiz=</span><span class="cn">TRUE</span>, <span class="at">plot=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"blue4"</span>, <span class="at">border=</span><span class="cn">NA</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">"Fraction"</span>, <span class="at">ylab=</span><span class="st">"Age"</span>, <span class="at">axis.lty=</span><span class="dv">1</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.06</span>))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>,<span class="at">at=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">60</span>,<span class="at">by=</span><span class="dv">5</span>), <span class="at">tick=</span><span class="cn">FALSE</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex.axis=</span><span class="fl">0.75</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Ache"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(ea.kung<span class="sc">$</span>stable.age, <span class="at">horiz=</span><span class="cn">TRUE</span>, <span class="at">plot=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"green4"</span>, <span class="at">border=</span><span class="cn">NA</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">"Fraction"</span>, <span class="at">ylab=</span><span class="st">"Age"</span>, <span class="at">axis.lty=</span><span class="dv">1</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.06</span>))</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>,<span class="at">at=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">60</span>,<span class="at">by=</span><span class="dv">5</span>), <span class="at">tick=</span><span class="cn">FALSE</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex.axis=</span><span class="fl">0.75</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"!Kung"</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(ea.ven<span class="sc">$</span>stable.age, <span class="at">horiz=</span><span class="cn">TRUE</span>, <span class="at">plot=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"orange"</span>, <span class="at">border=</span><span class="cn">NA</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">"Fraction"</span>, <span class="at">ylab=</span><span class="st">"Age"</span>, <span class="at">axis.lty=</span><span class="dv">1</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.06</span>))</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>,<span class="at">at=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">60</span>,<span class="at">by=</span><span class="dv">5</span>), <span class="at">tick=</span><span class="cn">FALSE</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex.axis=</span><span class="fl">0.75</span>)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"Venezuela"</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(ea.usa<span class="sc">$</span>stable.age, <span class="at">horiz=</span><span class="cn">TRUE</span>, <span class="at">plot=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"red4"</span>, <span class="at">border=</span><span class="cn">NA</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">"Fraction"</span>, <span class="at">ylab=</span><span class="st">"Age"</span>, <span class="at">axis.lty=</span><span class="dv">1</span>, <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.06</span>))</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>,<span class="at">at=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">60</span>,<span class="at">by=</span><span class="dv">5</span>), <span class="at">tick=</span><span class="cn">FALSE</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">cex.axis=</span><span class="fl">0.75</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="st">"USA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="demog2_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now plot the sensitivities and the elasticities. I commented out the legends because they get too busy with multiple plots in a single figure. It’s good to be able to attach a legend though if you ever need the figure without all the previous context.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sensitivities</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">45</span>, ass, <span class="at">type=</span><span class="st">"l"</span>, </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"blue4"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Age"</span>, <span class="at">ylab=</span><span class="st">"Survival Sensitivity"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.046</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">45</span>, kss, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"green4"</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">47</span>, vss, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">47</span>,uss,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">"red4"</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#legend("topright",c("Ache","!Kung","Venezuela","USA"), lwd=3, col=c("blue4","green4","orange","red4"))</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="do">## fertility</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">46</span>, asf, <span class="at">type=</span><span class="st">"l"</span>, </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"blue4"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Age"</span>, <span class="at">ylab=</span><span class="st">"Survival Sensitivity"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.046</span>))</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">46</span>, ksf, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"green4"</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">48</span>, vsf, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">48</span>,usf,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">"red4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="demog2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#legend("topright",c("Ache","!Kung","Venezuela","USA"), lwd=3, col=c("blue4","green4","orange","red4"))</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># elasticities</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">45</span>, aes, <span class="at">type=</span><span class="st">"l"</span>, </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"blue4"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Age"</span>, <span class="at">ylab=</span><span class="st">"Survival Elasticity"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.044</span>))</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">45</span>, kes, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"green4"</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">47</span>, ves, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">47</span>,ues,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">"red4"</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">#legend("topright",c("Ache","!Kung","Venezuela","USA"), lwd=3, col=c("blue4","green4","orange","red4"))</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="do">## fertility</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">46</span>, aef, <span class="at">type=</span><span class="st">"l"</span>, </span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"blue4"</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Age"</span>, <span class="at">ylab=</span><span class="st">"Survival Elasticity"</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">48</span>), <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.044</span>))</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">46</span>, kef, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"green4"</span>)</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">48</span>, vef, <span class="at">lwd=</span><span class="dv">3</span>, <span class="at">col=</span><span class="st">"orange"</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">48</span>,uef,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">"red4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="demog2_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#legend("topright",c("Ache","!Kung","Venezuela","USA"), lwd=3, col=c("blue4","green4","orange","red4"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./demog1.html" class="pagination-link" aria-label="Demography I: Mortality">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Demography I: Mortality</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>